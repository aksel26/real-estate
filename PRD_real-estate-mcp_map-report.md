# PRD — 지도 기반 동네 리포트 & 콘텐츠 생성 앱 (real-estate-mcp 연동)

버전: v0.2 (A/D 중심 MVP)  
작성일: 2026-02-28 (KST)  
플랫폼: Web (Desktop 우선, Mobile 대응)

---

## 1) 제품 개요

### 한 줄 설명

지도에서 지역을 선택하면 **실거래/전월세의 집계 인사이트를 10초 안에 리포트로 보여주고**, 필요하면 **콘텐츠용 요약(문장/마크다운)으로 내보내는** 앱.

### 문제 정의

- **A(실거주·이사 준비자)**는 “이 동네가 대략 얼마 선인지 / 요즘 분위기(활성·관망·조정)”를 빠르게 알고 싶다.
- **D(콘텐츠·리서치 제작자)**는 숫자와 그래프를 바탕으로 “근거 있는 문장”을 반복 생성하고 싶다.
- 공공데이터 기반 조회는 호출 패턴이 반복(지역/월)되므로 **캐싱·프리패치가 UX를 좌우**한다.

### 제품 가치

- A에게: **후보 지역을 빠르게 좁히는 ‘스캔→확인’** 경험 제공
- D에게: **데이터→스토리(요약 문장/리포트)로 전환**을 자동화

---

## 2) 타깃 사용자

### A. 실거주·이사 준비자 (Primary)

- 니즈: 가격대 파악, 최근 흐름 파악, 전세 리스크 신호 확인
- 사용 패턴: 지도 클릭 → 10초 내 핵심만 확인 → 후보 비교

### D. 콘텐츠·리서치 제작자 (Primary)

- 니즈: 지역 동향 문장 생성, 랭킹/비교 리포트 제작, 반복 발행 자동화
- 사용 패턴: 여러 지역/기간 조회 → 요약/근거 표기 → 마크다운/이미지로 내보내기

---

## 3) 목표 및 성공 지표

### 목표

1. 지도에서 지역 클릭 후 **핵심 리포트가 빠르게 노출**된다.
2. 동일 지역/기간 재방문 시 **캐시 히트로 즉시 전환**된다.
3. D가 “근거 있는 문장”을 **내보내기(Export)**로 바로 제작한다.
4. 집계값의 한계를 투명하게 노출해 **신뢰를 유지**한다(표본수/참고 고지).

### 성공 지표 (MVP)

- 캐시 히트 구간에서 탭/필터 전환 시 **체감 지연 최소화**(즉시 전환 체감)
- 동일 지역/기간 재조회 네트워크 요청 감소(클라/서버 캐시로 재사용)
- Export 사용 흐름에서 “요약 + 근거(기간/표본수/소스)”가 누락되지 않음
- 표본 부족 케이스에서 사용자 혼란(오해) 방지: **‘표본 부족’ 배지 노출율 100%**

---

## 4) 범위 (Scope)

### MVP(v0.2) — A/D 중심 필수 기능

**A. 지도 기반 탐색(필수)**

- 지도: Kakao Map
- 지역 선택: 구/동 단위(데이터 정합을 고려해 MVP는 구 중심 가능)
- 선택 지역 표시(상단 pill) + 우측 리포트 패널 자동 오픈

**B. 동네 리포트(필수)**

- 기간: 최근 6개월(월별)
- 지표(필수)
  - 매매: **중위 매매가**, 거래량, 범위(가능 시)
  - 전월세: **중위 보증금/월세**, 거래량
  - **전세가율(보증금 중위 / 매매 중위)** 배지
  - **표본수(sample_count)** 및 데이터 범위 고지
- “한 줄 요약”(필수)
  - 예: “최근 6개월 중위 매매가 △%, 거래량 ▽%”

**C. 콘텐츠 제작(필수, D 타깃 핵심)**

- Export(필수)
  - **Markdown 복사/다운로드**: 요약 문장 + 핵심 숫자 + 근거(기간/표본수/소스)
- 리포트 템플릿(필수)
  - 지역 개요 / 가격 / 거래량 / 전월세 / 리스크 / 한 줄 결론

**D. 마이크로 인터랙션(필수)**

- 패널 슬라이드, 탭 인디케이터, 카드 접힘/펼침, 로딩 스켈레톤
- 지도 hover/선택 피드백(강조/하이라이트)

**E. 기술 요구(필수)**

- Next.js(App Router) + Route Handlers(BFF)
- Tailwind CSS v4
- Framer Motion(Motion)
- TanStack Query(서버 데이터 캐시/동기화)
- Zustand(UI/지도 상태)

### 비목표(Non-goals)

- 실시간 호가/민간 시세
- 회원/결제/개인화 추천
- 투자 자문 수준의 판단 제공

---

## 5) 정보 구조(IA) / 화면

### 라우팅

- `/` : Map + Neighborhood Report + Export
- (옵션/V1) `/subscription` : 청약
- (옵션/V1) `/auction` : 공매

### 메인 레이아웃

- 좌측: 지도(폴리곤/마커)
- 우측: 리포트 패널(탭: 매매/전월세/요약)
- 상단: 선택 지역 pill + 필터(유형/기간) + Export 버튼

---

## 6) 사용자 플로우

### 플로우 A (이사 준비자)

1. 지도 클릭(지역 선택)
2. 패널 오픈 + 스켈레톤
3. 매매/전월세 요약 카드 노출
4. 전세가율/거래량 추세로 후보 판단
5. 인접 지역 클릭 → 비교(빠른 전환)

### 플로우 D (콘텐츠 제작자)

1. 지역 선택(여러 곳 순회)
2. 요약 문장 + 근거 확인
3. Export 클릭 → Markdown 생성
4. 복사/다운로드 → 블로그/리포트에 붙여넣기

---

## 7) 기능 요구사항 (Functional Requirements)

### 7.1 지도/지역

- 지도 엔진: Kakao Map
- 선택: 단일 선택(구/동)
- 상태:
  - hover 강조
  - 선택 고정 강조
- 줌 레벨에 따른 표현(옵션)
  - 구 레벨: 폴리곤/집계
  - 동 레벨: 마커/집계

### 7.2 데이터 조회/집계

- 데이터 출처: real-estate-mcp(MCP 서버) → 공공데이터
- 조회 단위:
  - `region_code(5자리)` + `YYYYMM` 기반
- 집계 제공
  - MCP 응답의 summary + items 기반 추가 집계(동별 그룹핑 등)
- **표본수/대표성 고지(필수)**
  - `sample_count` 노출
  - `total_count > sample_count` 또는 sample_count가 낮으면 “표본 기반” 경고 배지

### 7.3 리포트 UI

- 필수 카드 3종
  1. 매매 중위가 + 변화율(6개월)
  2. 전월세(보증금/월세) 중위 + 변화율(6개월)
  3. 거래량(월별) + 변화율(6개월)
- 배지
  - 전세가율(주의/보통/양호) — 규칙 기반
  - 표본수(충분/부족) — 규칙 기반
- 한 줄 요약
  - 템플릿 기반(LLM 없어도 생성 가능)

### 7.4 Export (D 핵심)

- Export 버튼 클릭 시 생성 내용
  - 제목: “{지역} 동네 리포트 ({기간})”
  - 한 줄 요약
  - 핵심 지표(매매/전월세/거래량/전세가율)
  - 근거: 기간, 표본수, 데이터 소스, 참고 고지
- 제공 방식
  - Markdown 복사(클립보드)
  - Markdown 파일 다운로드(옵션)

---

## 8) 상태 관리/데이터 캐싱 설계

### 원칙

- **TanStack Query = 서버 데이터**
- **Zustand = UI/지도 상태(서버 데이터 저장 금지)**

### Zustand 스토어(예시)

- selection: `selectedLawd`, `selectedName`
- map: `center`, `zoom`, `bounds`, `hoverId`
- ui: `panelOpen`, `activeTab`
- filters: `propertyType`, `months(기본 6)`

### TanStack Query Key(예시)

- `['report', propertyType, selectedLawd, months]`
- 월별 상세 필요 시: `['trades', type, lawd, ym]`, `['rents', ...]`

### 캐싱 가이드

- 실거래/전월세: staleTime 10~30분, gcTime 1~6시간
- 프리패치(옵션)
  - 최근 6개월 리포트 요청 후, 상세 탭을 대비해 일부 월 prefetch

---

## 9) API / 아키텍처

### 아키텍처

- Client → Next Route Handlers(BFF) → MCP Server(HTTP) → 공공데이터

### BFF API(예시)

- `GET /api/region-code?q=...`
- `GET /api/report?type=apartment&lawd=11680&months=6`
- (옵션) `GET /api/trades?type=...&lawd=...&ym=...`
- (옵션) `GET /api/rents?type=...&lawd=...&ym=...`

### 보안

- 공공데이터 API 키는 MCP/서버에만 존재
- BFF에서 파라미터 검증(YYYYMM, lawd 포맷, type whitelist)

---

## 10) 마이크로 인터랙션 요구사항 (Motion)

필수 적용

1. 패널 열기/닫기: slide + spring
2. 탭 전환 인디케이터: layoutId 이동
3. 카드 접힘/펼침: layout 기반 height 애니메이션
4. 로딩 스켈레톤 + 상태 dot
5. 지도 hover/선택: 시각 강조(투명도/선 굵기)

---

## 11) 리스크 및 대응

1. **집계 대표성(표본 기반)**

- 대응: sample_count/total_count 노출, 표본 부족 배지, “참고용” 고지

2. **외부 API 지연/실패**

- 대응: 서버 캐시 + 클라 캐시 + 재시도 UX + 마지막 성공 데이터 유지

3. **지도 지오코딩 남발**

- 대응: MVP는 구/동 중심 집계로 설계, 필요 시 후보 선택 UX + 캐싱

---

## 12) 완료 기준(Acceptance Criteria)

### MVP 완료 기준

- 지도에서 지역 선택 시 패널이 열리고, 최근 6개월 매매/전월세/거래량 요약이 표시된다.
- 표본수(sample_count)와 참고 고지가 항상 노출된다(표본 부족 시 경고 배지 포함).
- 탭/필터 전환 시 지도는 끊기지 않고, 캐시 히트 시 즉시 전환된다.
- Export 버튼으로 “요약+지표+근거”가 포함된 Markdown을 복사/다운로드할 수 있다.
- API 키는 클라이언트에 노출되지 않는다(BFF를 통해서만 조회).

---

## 13) 백로그 (V1)

- 청약/공매 탭 추가(지역 필터 + 지도/리스트 동기화)
- 행정동/법정동 경계 정합 고도화(GeoJSON 개선/매핑)
- 비교 모드(2~3개 지역 스냅샷 비교)
- 이미지 내보내기(차트 캡처) / 리포트 PDF(옵션)
