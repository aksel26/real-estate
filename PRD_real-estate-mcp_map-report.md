# PRD — 지도 기반 부동산 리포트 앱 (MCP 연동)

버전: v0.1 (MVP)  
작성일: 2026-02-26 (KST)  
플랫폼: Web (Desktop 우선, Mobile 대응)

---

## 1) 제품 개요

### 한 줄 설명
지도에서 지역을 선택하면 **실거래/전월세/청약/공매 정보를 “동네 리포트”로 요약**해 주는 앱. 데이터 조회는 `real-estate-mcp`(MCP 서버)가 담당하고, 웹앱은 Next.js가 BFF로 중계한다.

### 왜 만드는가 (문제 정의)
- 부동산 정보는 “지역/기간/유형”에 따라 흩어져 있고, 조회·비교·요약이 번거롭다.
- 지도 탐색 UX에서 **반복 조회(같은 지역/월)**가 많아 **캐싱/프리패치**가 UX를 좌우한다.
- LLM+MCP 도구 기반으로 “데이터 조회 → 계산/요약 → 리포트화” 흐름을 구현해보고 싶다.

---

## 2) 목표 및 성공 지표

### 목표(Goals)
1. **지도 중심 탐색**: 구/동 선택만으로 핵심 지표(가격/거래량/전세가율/트렌드)를 즉시 확인
2. **캐시 기반 빠른 UX**: 탭/필터 변경 시 “새로고침 같은 끊김” 최소화
3. **확장 가능한 구조**: MCP 툴 추가/변경에도 프론트 영향 최소화(REST 래핑, 타입/정규화)

### 비목표(Non-goals)
- 실시간 시세/호가(민간 데이터) 제공
- 회원/결제/개인화 추천(초기 제외)
- 법적 고지/투자 자문 수준의 기능

### 성공 지표(MVP)
- 지역 선택 후 리포트 패널 “첫 유효 데이터” 표시까지 체감 지연 최소화(캐시 히트 시 즉시)
- 동일 지역/기간 재방문 시 네트워크 요청 감소(클라/서버 캐시로 재사용)
- 오류(외부 API 실패) 발생 시 사용자에게 명확한 상태/대안 제공

---

## 3) 타깃 사용자 / 주요 시나리오

### Persona
- “지역 비교가 필요한 사용자”: 동네별 매매/전월세 분위기, 거래량 변화 확인
- “청약 관심 사용자”: 모집공고/경쟁률/일정 확인
- “공매 관심 사용자”: 조건 필터로 대상 리스트/지도 확인

### 핵심 사용자 시나리오
1) 지도에서 **서울 강남구** 클릭 → 최근 6개월 **매매 중위가/거래량 트렌드** 확인  
2) 탭 전환(매매 ↔ 전월세) → 동일 지역에서 **전세가율/보증금 트렌드** 확인  
3) 청약 탭 → 해당 지역 관련 공고를 **캘린더+카드**로 확인  
4) 공매 탭 → 조건(최저입찰가/상태) 필터 후 **지도+리스트 동기화**로 탐색

---

## 4) 범위 (Scope)

### MVP 기능 (v0.1)
**A. 지도 기반 지역 선택(필수)**
- 카카오맵 기반
- 폴리곤(시군구/행정동 중 택1) + 클릭 선택
- 선택 지역 표시(상단 pill) + 우측 리포트 패널 오픈

**B. 동네 리포트**
- 실거래(매매) 요약: 최근 6개월
  - 중위 매매가, 거래량, 최고/최저(또는 분위 범위)
- 전월세 요약: 최근 6개월
  - 중위 보증금/월세, 거래량
- 전세가율(보증금 중위 / 매매 중위) 배지(주의/보통/양호)

**C. 마이크로 인터랙션**
- 패널 슬라이드 인/아웃, 카드 접힘/펼침, 필터 칩 애니메이션
- 로딩 스켈레톤 + 상태 메시지(“데이터 업데이트 중”)

**D. 기술 요구(필수)**
- Next.js App Router + Route Handlers(BFF)
- Tailwind CSS v4
- Framer Motion(Motion) 기반 micro-interaction
- TanStack Query(서버 데이터 캐시/동기화)
- Zustand(UI/지도 상태)

### V1 이후 (확장)
- 행정동/법정동 경계 정합 강화(GeoJSON 개선)
- 청약/공매 탭 정식화(필터/정렬/캘린더)
- “내 집 마련 시나리오” 계산기(대출/현금흐름/복리)
- 검색(주소/단지명) + 후보 선택 UX

---

## 5) 정보 구조(IA) / 화면 구성

### 라우팅
- `/` : Map + Neighborhood Report (메인)
- `/subscription` : 청약 지도/리스트
- `/auction` : 공매 지도/리스트

### 메인 화면 레이아웃
- 좌측 70%: 지도(폴리곤/마커/클러스터)
- 우측 30%: 리포트 패널(탭: 매매/전월세/요약)
- 상단: 지역 선택 pill + 기간(최근 6개월) + 유형 필터(아파트/오피스텔/연립…)

---

## 6) UX 플로우

### 플로우 1: 지역 선택 → 리포트 표시
1. 사용자 폴리곤 클릭(구/동)
2. Zustand에 `selectedRegion` 업데이트
3. TanStack Query가 `queryKey` 변화 감지 → `/api/...` 호출
4. 패널 오픈(모션) + 스켈레톤
5. 데이터 도착 → 요약 카드 렌더 + 차트 표시
6. (선택) 인접 기간 프리패치(이전/다음 월)

### 플로우 2: 필터 변경(유형/기간)
- Zustand가 필터 변경 저장 → Query key만 변경 → 캐시 히트면 즉시 전환
- 캐시 미스면 “패널 유지 + 내용만 로딩” (지도 끊김 금지)

---

## 7) 기능 요구사항 (Functional Requirements)

### 7.1 지도/지역
- 지도 엔진: Kakao Map
- 폴리곤 레이어:
  - MVP: 시군구(구 단위) 또는 행정동(가능하면)
- 상호작용:
  - 클릭: 선택(단일)
  - hover: 하이라이트(선택 전 미리보기)
  - 줌 레벨에 따라 레이어 밀도 조절(선택)

### 7.2 실거래/전월세 리포트
- 지원 유형(MVP 우선순위):
  1) 아파트
  2) 오피스텔
  3) 연립다세대(옵션)
- 기간: 최근 6개월(고정) + 월 단위
- 지표:
  - 중위값(가격/보증금/월세)
  - 거래량
  - 범위(상/하위 분위 또는 min/max) — 데이터 품질에 따라 선택
  - 전세가율(보증금 중위 / 매매 중위)

### 7.3 청약(옵션: V1에 포함 가능)
- 지역 필터 기반 공고 리스트
- 카드: 단지명/일정/모집유형/지역
- 캘린더 뷰(모집/당첨/계약)

### 7.4 공매(옵션: V1)
- 지역 + 가격 범위 + 상태 필터
- 지도 핀 + 리스트 동기화

---

## 8) 비기능 요구사항 (Non-Functional)

### 성능
- 지도 이동/줌은 “데이터 로딩과 분리”(끊김 금지)
- 리스트는 가상화(특히 공매/거래 상세 리스트)
- 마커/폴리곤 렌더 최적화(메모이제이션, 최소 리렌더)

### 신뢰성/오류 처리
- 외부 API 실패 시:
  - “요청 실패” 토스트 + 재시도 버튼
  - 마지막 성공 데이터가 있다면 stale 표시로 유지
- 요청 폭주 방지: 서버에서 레이트리밋/캐시

### 보안
- 공공데이터 API 키는 브라우저 노출 금지
- Next Route Handlers에서 입력 검증(지역명/코드/월 포맷)
- CORS 최소화, 서버에서만 MCP 호출

---

## 9) 기술 설계

### 9.1 스택
- Front: Next.js 14(App Router), React, TypeScript
- UI: Tailwind CSS v4, Motion(Framer Motion)
- Server(BFF): Next Route Handlers
- Data:
  - MCP Server: `real-estate-mcp` (HTTP)
  - TanStack Query(클라 캐시)
  - Zustand(UI/지도 상태)

---

### 9.2 데이터 플로우 / MCP 연동

#### 원칙
- 프론트는 MCP를 직접 호출하지 않는다.
- Next API가 MCP를 호출해 **REST 형태로 정규화**해 내려준다.

#### API(예시)
- `GET /api/region-code?q=서울 강남구 삼성동`
  - 응답: `{ lawd: "11680", name: "...", candidates?: [...] }`
- `GET /api/trades?type=apartment&lawd=11680&ym=202601`
- `GET /api/rents?type=apartment&lawd=11680&ym=202601`
- `GET /api/report?type=apartment&lawd=11680&months=6`
  - 서버에서 월별 호출 후 **집계/요약**해서 한 번에 내려주는 엔드포인트(추천)

> 추천: 프론트 단순화를 위해 `/api/report`를 메인으로 두고, 상세 탭에서만 월별 원본을 호출.

---

### 9.3 캐싱 설계

#### 서버(Next) 캐싱
- 월별 고정 데이터 성격 → `revalidate` 길게
- Tag 기반:
  - `trades:${type}:${lawd}:${ym}`
  - `rents:${type}:${lawd}:${ym}`
  - `report:${type}:${lawd}:m6`
- 청약/공매는 짧게 revalidate(10~30분)

#### 클라이언트(TanStack Query) 캐싱
- QueryKey 예시:
  - `['report', type, lawd, months]`
  - `['trades', type, lawd, ym]`
- 옵션 가이드:
  - 실거래/전월세: `staleTime` 10~30분, `gcTime` 1~6시간
  - 청약/공매: `staleTime` 3~10분
- 프리패치:
  - 선택 지역 기준 “이전/다음 월” 또는 “최근 6개월 집계”를 미리 로딩

---

### 9.4 상태 관리 원칙 (Zustand + Query)

#### Zustand에는 “서버 데이터”를 넣지 않는다
Zustand는 **queryKey 재료 + UI/지도 상태만** 유지.

##### Store 설계(예시)
- `mapStore`
  - `center`, `zoom`, `bounds`, `hoverRegionId`
- `selectionStore`
  - `selectedLawd`, `selectedRegionName`, `selectedPolygonId`
- `uiStore`
  - `rightPanelOpen`, `activeTab`(trade/rent/subscription/auction)
- `filterStore`
  - `propertyType`, `months`, `priceRange`, `areaRange`

TanStack Query는 위 상태로부터 `queryKey`를 구성해 fetch.

---

## 10) 마이크로 인터랙션(필수) 정의

### 적용 포인트
1) 우측 패널 열기/닫기: `AnimatePresence` + spring slide  
2) 탭 전환: `layoutId`로 인디케이터(underline/pill) 이동  
3) 카드 접힘/펼침(요약↔상세): height 자동 애니메이션(layout)  
4) 로딩: skeleton + 상단 status dot(로딩/성공/실패)  
5) 지도 hover/선택: 폴리곤 강조(투명도/선 굵기) + 선택 pill bounce-in  
6) 리스트 hover ↔ 지도 하이라이트 동기화(지연 없는 피드백)

---

## 11) 분석/로그(선택)

### 이벤트(간단)
- `region_select`
- `tab_change`
- `filter_change`
- `api_error` (endpoint, status, region)

---

## 12) 리스크 및 대응

1) **행정동/법정동 경계 정합 문제**  
- 대응: MVP는 구 단위로 시작 → V1에서 정합 개선(법정동 경계/매핑 테이블)

2) **외부 API 호출 제한/지연**  
- 대응: 서버 캐시 + 클라 캐시 + 프리패치 + 백오프 재시도

3) **지도 API 쿼터**  
- 대응: 지오코딩 남발 방지(동 단위 집계, 후보 선택), 캐시, 필요 시 폴리곤 중심좌표 사전 데이터 사용

---

## 13) 완료 기준(Acceptance Criteria)

### MVP 완료 기준
- 지도에서 구(또는 동) 선택 시 **리포트 패널이 열리고**, 최근 6개월 매매/전월세 요약이 표시된다.
- 탭/필터 전환 시 지도는 끊기지 않고, 캐시 히트 시 즉시 전환된다.
- 네트워크 오류 시 스켈레톤/에러 상태/재시도 UX가 동작한다.
- API 키는 클라이언트에 노출되지 않는다(Next BFF를 통해서만 데이터 조회).
